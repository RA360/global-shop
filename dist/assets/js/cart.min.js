"use strict";function _toConsumableArray(a){return _arrayWithoutHoles(a)||_iterableToArray(a)||_unsupportedIterableToArray(a)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(a,b){if(a){if("string"==typeof a)return _arrayLikeToArray(a,b);var c=Object.prototype.toString.call(a).slice(8,-1);return"Object"===c&&a.constructor&&(c=a.constructor.name),"Map"===c||"Set"===c?Array.from(a):"Arguments"===c||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c)?_arrayLikeToArray(a,b):void 0}}function _iterableToArray(a){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(a))return Array.from(a)}function _arrayWithoutHoles(a){if(Array.isArray(a))return _arrayLikeToArray(a)}function _arrayLikeToArray(a,b){(null==b||b>a.length)&&(b=a.length);for(var c=0,d=Array(b);c<b;c++)d[c]=a[c];return d}var cart=document.querySelector("#cart");document.body.classList.add("full-height"),cart.innerHTML="<div class=\"spinner center\"><div class=\"rect\"></div><div class=\"rect rect_2\"></div><div class=\"rect rect_3\"></div><div class=\"rect rect_4\"></div><div class=\"rect rect_5\"></div></div>";var insertEmptyCart=function(){document.body.classList.add("full-height"),cart.innerHTML="<div class=\"cart__empty center\"><img src=\"../assets/img/empty.png\" alt=\"\"><p class=\"cart__not-found not-found\">Your cart is currently empty.</p></div>"},cartGoods=JSON.parse(localStorage.getItem("goods"));cartGoods?fetch("ajax/cartGoods",{method:"POST",body:JSON.stringify(cartGoods)}).then(function(a){return a.text()}).then(function(a){document.body.classList.remove("full-height"),cart.innerHTML=a;var b=document.querySelector("#grandTotalNum"),c=function(a){var c=a.querySelector(".quantity__num"),d=a.querySelector(".js-decrease"),e=a.querySelector(".js-increase");+c.value<+c.dataset.quantity?(e.disabled=!1,d.disabled=!1,1==+c.value&&(d.disabled=!0)):(c.value=c.dataset.quantity,e.disabled=!0),a.querySelector(".js-total").textContent=+(+a.querySelector(".js-price").textContent*+c.value).toFixed(2),b.textContent=_toConsumableArray(document.querySelectorAll(".js-total")).reduce(function(a,b){return+(a+ +b.textContent).toFixed(2)},0)};document.querySelectorAll(".quantity__btn").forEach(function(a){a.addEventListener("click",function(){var b=a.parentNode.parentNode.parentNode,d=b.querySelector(".quantity__num");d.value=a.classList.contains("js-decrease")?+d.value-1:+d.value+1,c(b)})}),document.querySelectorAll(".quantity__num").forEach(function(a){a.addEventListener("input",function(){var b=a.value;a.value=b.replace(/[^\d]/g,""),0==b[0]?a.value=b.substr(1):""==b?a.value=1:c(a.parentNode.parentNode.parentNode)})}),document.querySelectorAll(".cart__delete").forEach(function(a){a.addEventListener("click",function(){var c=a.parentNode.parentNode;cartGoods=cartGoods.filter(function(a){return!a[c.dataset.goodsId]}),cartGoods.length?(localStorage.setItem("goods",JSON.stringify(cartGoods)),b.textContent=+(+b.textContent-+c.querySelector(".js-total").textContent).toFixed(2),c==document.querySelectorAll(".cart__box")[0]&&["Price","Qty","Total","Delete"].forEach(function(a,b){return document.querySelectorAll(".cart__box")[1].querySelectorAll(".cart__group")[b].insertAdjacentHTML("afterbegin","<h4 class=\"cart__title\">".concat(a,"</h4>"))}),c.remove()):(localStorage.removeItem("goods"),insertEmptyCart())})}),document.querySelector("#checkout").addEventListener("click",function(){var a=document.createElement("div");a.className="order-overlay",a.innerHTML="<div class=\"order popup center\">\n                                   <button class=\"close\" id=\"orderClose\"></button>\n                                   <form id=\"orderForm\">\n                                    <label for=\"email\">Email</label>\n                                    <input id=\"email\" type=\"email\" name=\"email\" placeholder=\"example@domain.com\" required />\n                                    <p class=\"error\" id=\"orderErr\"></p>\n                                    <button class=\"submit black-btn\" type=\"submit\">Send payment details</button>\n                                   </form>\n                                  </div>",document.body.classList.add("full-height"),document.body.appendChild(a);var b=function(a){return document.querySelectorAll("body>*:not(.order-overlay)").forEach(function(b){return b.style.filter=a})};b("blur(2px)"),document.querySelector("#orderClose").addEventListener("click",function(a){b("none"),document.body.classList.remove("full-height"),a.target.parentNode.parentNode.remove()}),document.querySelector("#orderForm").addEventListener("submit",function(a){a.preventDefault(),fetch("ajax/order",{method:"POST",body:new FormData(a.target)}).then(function(a){return a.json()}).then(function(b){if(b.error)document.querySelector("#orderErr").textContent=b.txt;else{localStorage.removeItem("goods"),insertEmptyCart();var c=document.createElement("p");c.className="success",c.textContent=b.txt,a.target.parentNode.replaceChild(c,a.target)}})})})}):insertEmptyCart();